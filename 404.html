<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Criador de Anúncio de Veículo | Anúncios Profissionais</title>
    <meta name="description" content="Crie anúncios de veículos profissionais em segundos. Carregue as fotos, preencha os dados e baixe a imagem de venda gratuitamente. Ideal para concessionárias e vendedores.">
    <meta name="keywords" content="criador de anúncio, anúncio de veículo, gerador de anúncio, venda de carro, anúncio profissional, marketing automotivo">
    <link rel="canonical" href="https://criadordeanuncio.com/">
    <link rel="icon" type="image/png" href="https://criadordeanuncio.com/images/favicon.png">

    <!-- Open Graph / Facebook / WhatsApp -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://criadordeanuncio.com/">
    <meta property="og:title" content="Criador de Anúncio de Veículo">
    <meta property="og:description" content="Transforme fotos comuns em anúncios de veículos profissionais e atraentes em segundos.">
    <meta property="og:image" content="https://criadordeanuncio.com/images/logo.png">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://criadordeanuncio.com/">
    <meta property="twitter:title" content="Criador de Anúncio de Veículo">
    <meta property="twitter:description" content="Transforme fotos comuns em anúncios de veículos profissionais e atraentes em segundos.">
    <meta property="twitter:image" content="https://criadordeanuncio.com/images/logo.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .peer:checked ~ .peer-checked\:after\:translate-x-full::after {
            transform: translateX(100%);
        }
        .peer:checked ~ .peer-checked\:bg-red-600 {
            background-color: #DC2626;
        }
        input[type="file"]::file-selector-button {
            @apply bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg cursor-pointer transition-colors duration-300;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #db2777;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
     <!-- Schema Markup - JSON-LD -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "SoftwareApplication",
      "name": "Criador de Anúncio de Veículo",
      "applicationCategory": "DesignApplication",
      "operatingSystem": "Any",
      "description": "Ferramenta online gratuita para criar anúncios de veículos profissionais a partir de fotos. Os usuários podem adicionar informações como marca, modelo, preço e contato para gerar uma imagem de venda personalizada.",
      "offers": {
        "@type": "Offer",
        "price": "0"
      }
    }
    </script>
</head>
<body class="bg-gray-900 text-white font-sans antialiased">

    <div class="container mx-auto p-4 md:p-8 max-w-6xl">
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold text-red-500">Criador de Anúncio de Veículo</h1>
            <p class="text-gray-400 mt-2">Preencha os dados, anexe uma ou mais fotos e crie suas imagens de venda.</p>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <div class="bg-gray-800 p-6 rounded-xl shadow-2xl">
                <form id="vehicleForm" class="space-y-6">
                    <div>
                        <label for="vehiclePhoto" class="block text-lg font-semibold text-gray-200 mb-2">1. Fotos do Veículo</label>
                        <input type="file" id="vehiclePhoto" accept="image/*" required multiple class="block w-full text-sm text-gray-400 file:mr-4 file:border-0 rounded-lg">
                        <div id="thumbnails" class="mt-4 flex flex-wrap gap-4"></div>
                    </div>
                    
                    <hr class="border-gray-600">
                    <h2 class="text-lg font-semibold text-gray-200 !mt-4">2. Detalhes do Anúncio</h2>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="marca" class="block text-sm font-medium text-gray-300">Marca</label>
                            <input type="text" id="marca" placeholder="Ex: Hyundai" class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm focus:ring-red-500 focus:border-red-500 text-white">
                        </div>
                        <div>
                            <label for="modelo" class="block text-sm font-medium text-gray-300">Modelo</label>
                            <input type="text" id="modelo" placeholder="Ex: HB20 Comfort" class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm focus:ring-red-500 focus:border-red-500 text-white">
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="ano" class="block text-sm font-medium text-gray-300">Ano</label>
                            <input type="text" id="ano" placeholder="Ex: 2022" class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm focus:ring-red-500 focus:border-red-500 text-white">
                        </div>
                        <div>
                            <label for="km" class="block text-sm font-medium text-gray-300">Kilometragem</label>
                            <input type="text" id="km" placeholder="Ex: 50000" class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm focus:ring-red-500 focus:border-red-500 text-white">
                        </div>
                    </div>

                    <div>
                        <label for="cilindrada" class="block text-sm font-medium text-gray-300">Motor</label>
                        <input type="text" id="cilindrada" placeholder="Ex: 1.0" class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm focus:ring-red-500 focus:border-red-500 text-white">
                    </div>
                    
                    <div class="flex items-center justify-between">
                         <label for="cambio" class="block text-sm font-medium text-gray-300">Câmbio</label>
                        <div class="flex items-center space-x-3">
                            <span class="text-sm font-medium text-gray-400">Manual</span>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="cambio" class="sr-only peer">
                                <div class="w-11 h-6 bg-gray-600 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-red-600"></div>
                            </label>
                             <span class="text-sm font-medium text-gray-400">Automático</span>
                        </div>
                    </div>

                    <div>
                        <label for="observacao" class="block text-sm font-medium text-gray-300">Observação</label>
                        <input type="text" id="observacao" placeholder="Ex: Completo, único dono, todas as revisões feitas" class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm focus:ring-red-500 focus:border-red-500 text-white">
                    </div>

                     <div>
                        <label for="preco" class="block text-sm font-medium text-gray-300">Preço</label>
                        <input type="text" id="preco" placeholder="Ex: 59900" class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm focus:ring-red-500 focus:border-red-500 text-white">
                    </div>

                    <hr class="border-gray-600">
                    <h2 class="text-lg font-semibold text-gray-200 !mt-4">3. Contato</h2>
                    <div>
                        <label for="telefone" class="block text-sm font-medium text-gray-300">Telefone para WhatsApp</label>
                        <input type="tel" id="telefone" maxlength="15" placeholder="(00) 90000-0000" class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm focus:ring-red-500 focus:border-red-500 text-white">
                    </div>
                </form>
            </div>

            <div class="bg-gray-800 p-6 rounded-xl shadow-2xl flex flex-col items-center justify-center min-h-[400px]">
                <div class="w-full relative">
                    <div id="previewArea" class="w-full aspect-video bg-gray-700 rounded-md flex items-center justify-center text-gray-500 border-2 border-dashed border-gray-600 transition-all duration-300">
                        <span id="previewPlaceholder" class="text-center">A prévia da imagem aparecerá aqui<br>após carregar uma foto.</span>
                    </div>
                    <button id="prevButton" class="hidden absolute top-1/2 left-2 transform -translate-y-1/2 bg-gray-900 bg-opacity-60 hover:bg-opacity-80 text-white rounded-full w-10 h-10 flex items-center justify-center transition-opacity focus:outline-none disabled:opacity-30 disabled:cursor-not-allowed z-10">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
                    </button>
                    <button id="nextButton" class="hidden absolute top-1/2 right-2 transform -translate-y-1/2 bg-gray-900 bg-opacity-60 hover:bg-opacity-80 text-white rounded-full w-10 h-10 flex items-center justify-center transition-opacity focus:outline-none disabled:opacity-30 disabled:cursor-not-allowed z-10">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
                    </button>
                </div>
                <div id="imageCounter" class="text-gray-400 mt-2 text-sm font-medium hidden"></div>
                <button id="downloadButton" class="hidden mt-4 bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg transition-colors text-lg flex items-center gap-3">
                </button>
            </div>
        </main>
    </div>

    <script>
        window.addEventListener('load', function() {
            const form = document.getElementById('vehicleForm');
            const fileInput = document.getElementById('vehiclePhoto');
            const thumbnailsContainer = document.getElementById('thumbnails');
            const telefoneInput = document.getElementById('telefone');
            const precoInput = document.getElementById('preco');
            const kmInput = document.getElementById('km');
            const previewArea = document.getElementById('previewArea');
            const previewPlaceholder = document.getElementById('previewPlaceholder');
            const downloadButton = document.getElementById('downloadButton');
            const prevButton = document.getElementById('prevButton');
            const nextButton = document.getElementById('nextButton');
            const imageCounter = document.getElementById('imageCounter');

            let uploadedImages = [];
            let currentPreviewIndex = 0;
            let isProcessing = false;
            const adColor = '#ce191f';
            const fixedAddress = "Av. São João, 3430";
            
            const fixedLogo = new Image();
            fixedLogo.src = "/images/logo.png";
            fixedLogo.crossOrigin = "Anonymous";

            const phoneIcon = new Image();
            phoneIcon.src = "https://criadordeanuncio.com/images/logo-zap.png";
            phoneIcon.crossOrigin = "Anonymous";

            const mapsIcon = new Image();
            mapsIcon.src = "https://criadordeanuncio.com/images/logo-maps.png";
            mapsIcon.crossOrigin = "Anonymous";
            
            const toolsIcon = new Image();
            toolsIcon.src = "https://criadordeanuncio.com/images/logo-tools.png";
            toolsIcon.crossOrigin = "Anonymous";

            function saveData() {
                localStorage.setItem('savedTelefone', telefoneInput.value);
            }

            function loadSavedData() {
                telefoneInput.value = localStorage.getItem('savedTelefone') || '';
                if (telefoneInput.value) telefoneInput.value = maskPhone(telefoneInput.value);
            }
            
            loadSavedData();

            fileInput.addEventListener('change', handleImageUpload);
            form.addEventListener('input', () => setTimeout(updatePreviewUI, 50));
            downloadButton.addEventListener('click', handleDownload);
            prevButton.addEventListener('click', () => {
                if (currentPreviewIndex > 0) {
                    currentPreviewIndex--;
                    updatePreviewUI();
                }
            });
            nextButton.addEventListener('click', () => {
                if (currentPreviewIndex < uploadedImages.length - 1) {
                    currentPreviewIndex++;
                    updatePreviewUI();
                }
            });
            telefoneInput.addEventListener('input', () => {
                telefoneInput.value = maskPhone(telefoneInput.value);
                saveData();
            });
            precoInput.addEventListener('input', (e) => {
                e.target.value = formatNumericInput(e.target.value);
            });
             kmInput.addEventListener('input', (e) => {
                e.target.value = formatNumericInput(e.target.value);
            });

            function maskPhone(value) {
                value = value.replace(/\D/g, '');
                value = value.replace(/^(\d{2})(\d)/, '($1) $2');
                value = value.replace(/(\d{4,5})(\d{4})$/, '$1-$2');
                return value;
            }
            
            function formatNumericInput(value) {
                return value.replace(/\D/g, '');
            }

            function formatPriceDisplay(price) {
                const number = parseFloat(price);
                if (isNaN(number)) return "";
                return number.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
            }

            function formatKmDisplay(km) {
                const number = parseInt(km, 10);
                if (isNaN(number)) return "";
                return `${number.toLocaleString('pt-BR')} KM`;
            }

            function renderThumbnails() {
                thumbnailsContainer.innerHTML = '';
                uploadedImages.forEach((img, index) => {
                    const thumbContainer = document.createElement('div');
                    thumbContainer.className = 'relative flex-shrink-0';

                    const thumbImage = document.createElement('img');
                    thumbImage.src = img.src;
                    thumbImage.className = "w-20 h-20 object-cover rounded-md border-2 border-gray-600";
                    thumbContainer.appendChild(thumbImage);

                    const deleteButton = document.createElement('button');
                    deleteButton.type = 'button';
                    deleteButton.innerHTML = '&times;';
                    deleteButton.className = "absolute top-0 right-0 -mt-2 -mr-2 bg-red-600 text-white rounded-full w-5 h-5 flex items-center justify-center text-lg font-bold leading-none focus:outline-none hover:bg-red-700 transition-transform transform hover:scale-110";
                    deleteButton.dataset.index = index;

                    deleteButton.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const indexToRemove = parseInt(e.currentTarget.dataset.index, 10);
                        removeImage(indexToRemove);
                    });

                    thumbContainer.appendChild(deleteButton);
                    thumbnailsContainer.appendChild(thumbContainer);
                });
            }

            function removeImage(index) {
                uploadedImages.splice(index, 1);
                if (currentPreviewIndex >= uploadedImages.length) {
                    currentPreviewIndex = Math.max(0, uploadedImages.length - 1);
                }
                renderThumbnails();
                updatePreviewUI();
            }

            function handleImageUpload(e) {
                const files = e.target.files;
                uploadedImages = [];
                currentPreviewIndex = 0;

                if (files.length === 0) {
                    renderThumbnails();
                    updatePreviewUI();
                    return;
                }

                const filePromises = Array.from(files).map(file => {
                    return new Promise((resolve, reject) => {
                        if (file.type.startsWith('image/')) {
                            const reader = new FileReader();
                            reader.onload = (event) => {
                                const img = new Image();
                                img.onload = () => {
                                    uploadedImages.push(img);
                                    resolve();
                                };
                                img.onerror = reject;
                                img.src = event.target.result;
                            };
                            reader.onerror = reject;
                            reader.readAsDataURL(file);
                        } else {
                            resolve();
                        }
                    });
                });

                Promise.all(filePromises).then(() => {
                    renderThumbnails();
                    updatePreviewUI();
                });
            }
            
            async function updatePreviewUI() {
                previewArea.innerHTML = '';

                if (uploadedImages.length === 0) {
                    previewArea.appendChild(previewPlaceholder);
                    downloadButton.classList.add('hidden');
                    prevButton.classList.add('hidden');
                    nextButton.classList.add('hidden');
                    imageCounter.classList.add('hidden');
                    return;
                }
                
                const currentImage = uploadedImages[currentPreviewIndex];
                const canvas = await createAdCanvas(currentImage);
                canvas.className = "rounded-md shadow-lg w-full h-auto";
                previewArea.appendChild(canvas);

                if (uploadedImages.length === 1) {
                    downloadButton.innerHTML = '<span>Baixar Anúncio</span>';
                } else {
                    downloadButton.innerHTML = `<span>Baixar Anúncios</span>`;
                }
                downloadButton.classList.remove('hidden');

                if (uploadedImages.length > 1) {
                    prevButton.classList.remove('hidden');
                    nextButton.classList.remove('hidden');
                    imageCounter.classList.remove('hidden');

                    imageCounter.textContent = `Imagem ${currentPreviewIndex + 1} de ${uploadedImages.length}`;

                    prevButton.disabled = currentPreviewIndex === 0;
                    
                    nextButton.disabled = currentPreviewIndex === uploadedImages.length - 1;
                } else {
                    prevButton.classList.add('hidden');
                    nextButton.classList.add('hidden');
                    imageCounter.classList.add('hidden');
                }
            }
            
            function getFormData() {
                return {
                    marca: document.getElementById('marca').value.trim(),
                    modelo: document.getElementById('modelo').value.trim(),
                    ano: document.getElementById('ano').value.trim(),
                    km: document.getElementById('km').value.trim(),
                    preco: document.getElementById('preco').value.trim(),
                    cilindrada: document.getElementById('cilindrada').value.trim(),
                    cambio: document.getElementById('cambio').checked ? 'Automático' : 'Manual',
                    observacao: document.getElementById('observacao').value.trim(),
                    telefone: document.getElementById('telefone').value.trim(),
                    endereco: fixedAddress,
                };
            }

            const adjustTextToFit = (ctx, text, icon, iconSize, iconGap, availableWidth, initialFontSize) => {
                let fontSize = initialFontSize;
                let textMetrics;
                let totalWidth;
                
                do {
                    ctx.font = `700 ${fontSize}px 'Inter'`;
                    textMetrics = ctx.measureText(text);
                    totalWidth = (icon ? iconSize + iconGap : 0) + textMetrics.width;
                    if (totalWidth > availableWidth) {
                        fontSize -= 1;
                    }
                } while (totalWidth > availableWidth && fontSize > 8);
                
                return { fontSize, totalWidth };
            };

            async function createAdCanvas(image) {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                const data = getFormData();
                const padding = image.width * 0.03;
                
                const headerHeight = image.height * 0.15;
                let baseFooterHeight = image.height * 0.18;
                let obsBarHeight = 0;
                let hasExtraObsBar = false;

                if (data.observacao && fixedLogo.complete && fixedLogo.naturalWidth !== 0) {
                    const tempCanvas = document.createElement('canvas');
                    const tempCtx = tempCanvas.getContext('2d');
                    const logoMaxHeight = baseFooterHeight * 1.1;
                    const logoMaxWidth = image.width * 0.4;
                    const scale = Math.min(logoMaxWidth / fixedLogo.width, logoMaxHeight / fixedLogo.height);
                    const logoW = fixedLogo.width * scale;
                    const logoRightBoundary = padding + logoW;
                    const availableInfoWidth = image.width - logoRightBoundary - padding * 2;

                    const infoTextWithObs = `${data.cambio.toUpperCase()}   |   ${data.cilindrada}   |   ${formatKmDisplay(data.km)}   |   ${data.observacao.toUpperCase()}`;
                    const tempFontSize = (baseFooterHeight * 0.4) * 0.5;
                    tempCtx.font = `700 ${tempFontSize}px 'Inter'`;
                    const textMetrics = tempCtx.measureText(infoTextWithObs);

                    if (textMetrics.width > availableInfoWidth) {
                        hasExtraObsBar = true;
                        obsBarHeight = baseFooterHeight * 0.4;
                    }
                }
                
                const footerHeight = baseFooterHeight + obsBarHeight;

                canvas.width = image.width;
                canvas.height = image.height + headerHeight + footerHeight;
                
                ctx.fillStyle = 'black';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.drawImage(image, 0, headerHeight, image.width, image.height);

                drawOverlays(ctx, canvas.width, image.height, headerHeight, footerHeight, data, hasExtraObsBar, obsBarHeight);
                return canvas;
            }

            function drawOverlays(ctx, width, imgHeight, headerHeight, footerHeight, data, hasExtraObsBar, obsBarHeight) {
                const padding = width * 0.03;
                
                ctx.fillStyle = 'rgba(0, 0, 0, 0.6)';
                ctx.fillRect(0, 0, width, headerHeight);

                ctx.textAlign = 'right';
                ctx.font = `900 ${headerHeight * 0.4}px 'Inter'`;
                const priceText = formatPriceDisplay(data.preco);
                const priceMetrics = ctx.measureText(priceText);
                const priceBoxPadding = headerHeight * 0.2;
                
                const minPriceBoxWidth = width * 0.35;
                const requiredPriceBoxWidth = priceMetrics.width + priceBoxPadding * 2;
                const priceBoxWidth = Math.max(minPriceBoxWidth, requiredPriceBoxWidth);

                const priceShapeStartX = width - priceBoxWidth;

                ctx.fillStyle = adColor;
                ctx.beginPath();
                ctx.moveTo(priceShapeStartX - (headerHeight*0.25), 0);
                ctx.lineTo(width, 0);
                ctx.lineTo(width, headerHeight);
                ctx.lineTo(priceShapeStartX, headerHeight);
                ctx.closePath();
                ctx.fill();

                ctx.fillStyle = 'white';
                ctx.textBaseline = 'middle';
                ctx.fillText(priceText, width - padding, headerHeight / 2);


                ctx.textAlign = 'left';
                const marcaY = headerHeight * 0.3;
                ctx.font = `900 ${headerHeight * 0.3}px 'Inter'`;
                ctx.fillText(data.marca.toUpperCase(), padding, marcaY);
                
                const modeloY = headerHeight * 0.65;
                ctx.font = `700 ${headerHeight * 0.23}px 'Inter'`;
                ctx.fillText(data.modelo.toUpperCase(), padding, modeloY);
                
                const modeloMetrics = ctx.measureText(data.modelo.toUpperCase());
                const anoX = padding + modeloMetrics.width + width * 0.02;
                
                ctx.font = `700 ${headerHeight * 0.18}px 'Inter'`;
                const anoMetrics = ctx.measureText(data.ano);
                
                ctx.fillStyle = adColor;
                ctx.fillRect(anoX - 5, modeloY - (headerHeight * 0.18)/2 - 5, anoMetrics.width + 10, headerHeight * 0.22 + 5);
                
                ctx.fillStyle = 'white';
                ctx.fillText(data.ano, anoX, modeloY);

                const footerStartY = imgHeight + headerHeight;
                const infoBarHeight = (footerHeight - obsBarHeight) * 0.4;
                const contactBarStartY = footerStartY + infoBarHeight + obsBarHeight;
                const contactBarHeight = footerHeight - infoBarHeight - obsBarHeight;
                
                let logoW = 0;
                if (fixedLogo.complete && fixedLogo.naturalWidth !== 0) {
                    const logoMaxHeight = footerHeight * 1.1;
                    const logoMaxWidth = width * 0.4;
                    const scale = Math.min(logoMaxWidth / fixedLogo.width, logoMaxHeight / fixedLogo.height);
                    logoW = fixedLogo.width * scale;
                }
                const logoRightBoundary = padding + logoW;

                ctx.fillStyle = adColor;
                ctx.fillRect(0, footerStartY, width, infoBarHeight);

                let centralText = `${data.cambio.toUpperCase()}   |   ${data.cilindrada}   |   ${formatKmDisplay(data.km)}`;
                if (!hasExtraObsBar && data.observacao) {
                    centralText += `   |   ${data.observacao.toUpperCase()}`;
                }

                const centralY = footerStartY + infoBarHeight / 2;
                const availableCentralWidth = width - padding - logoRightBoundary - padding;
                
                const vehicleInfoFit = adjustTextToFit(ctx, centralText, toolsIcon, infoBarHeight * 0.5, infoBarHeight * 0.2, availableCentralWidth, infoBarHeight * 0.5);
                ctx.font = `700 ${vehicleInfoFit.fontSize}px 'Inter'`;
                const centralIconSize = infoBarHeight * 0.5 * (vehicleInfoFit.fontSize / (infoBarHeight * 0.5));
                const centralIconGap = infoBarHeight * 0.2 * (vehicleInfoFit.fontSize / (infoBarHeight * 0.5));
                
                const centralStartX = width - padding - vehicleInfoFit.totalWidth;
                ctx.fillStyle = 'white';
                ctx.textAlign = 'left';
                if (toolsIcon.complete && toolsIcon.naturalWidth !== 0) {
                    ctx.drawImage(toolsIcon, centralStartX, centralY - centralIconSize / 2, centralIconSize, centralIconSize);
                }
                ctx.fillText(centralText, centralStartX + centralIconSize + centralIconGap, centralY);

                if (hasExtraObsBar) {
                    const obsBarStartY = footerStartY + infoBarHeight;
                    ctx.fillStyle = adColor;
                    ctx.fillRect(0, obsBarStartY, width, obsBarHeight);
                    const obsY = obsBarStartY + obsBarHeight / 2;
                    const availableObsWidth = width - padding - logoRightBoundary - padding;
                    
                    const obsFit = adjustTextToFit(ctx, data.observacao.toUpperCase(), null, 0, 0, availableObsWidth, infoBarHeight * 0.5);
                    ctx.fillStyle = 'white';
                    ctx.textAlign = 'right';
                    ctx.font = `700 ${obsFit.fontSize}px 'Inter'`;
                    ctx.fillText(data.observacao.toUpperCase(), width - padding, obsY);
                }
                
                ctx.fillStyle = 'rgba(10, 10, 10, 0.85)';
                ctx.fillRect(0, contactBarStartY, width, contactBarHeight);

                const items = [
                    { icon: phoneIcon, text: data.telefone },
                    { icon: mapsIcon, text: data.endereco }
                ];

                const contactY = contactBarStartY + contactBarHeight / 2;
                const itemGap = width * 0.03;
                const contactAreaWidth = width - logoRightBoundary - padding - itemGap;
                
                const initialContactFontSize = contactBarHeight * 0.45;
                let contactFontSize = initialContactFontSize;
                let totalContactWidth;
                
                do {
                    ctx.font = `700 ${contactFontSize}px 'Inter'`;
                    const iconSize = contactBarHeight * 0.5 * (contactFontSize / initialContactFontSize);
                    const textIconGap = iconSize * 0.4;
                    totalContactWidth = items.reduce((acc, item) => {
                        return acc + iconSize + textIconGap + ctx.measureText(item.text.toUpperCase()).width;
                    }, 0) + (items.length > 1 ? itemGap : 0);
                    
                    if (totalContactWidth > contactAreaWidth) {
                        contactFontSize--;
                    }
                } while(totalContactWidth > contactAreaWidth && contactFontSize > 8);
                
                
                const iconSize = contactBarHeight * 0.5 * (contactFontSize / initialContactFontSize);
                const textIconGap = iconSize * 0.4;
                let currentX = logoRightBoundary + itemGap + (contactAreaWidth - totalContactWidth) / 2;
                
                ctx.fillStyle = 'white';
                ctx.textAlign = 'left';
                items.forEach((item) => {
                    const itemWidth = iconSize + textIconGap + ctx.measureText(item.text.toUpperCase()).width;
                    if (item.icon.complete && item.icon.naturalWidth !== 0) {
                        ctx.drawImage(item.icon, currentX, contactY - iconSize / 2, iconSize, iconSize);
                    }
                    ctx.fillText(item.text.toUpperCase(), currentX + iconSize + textIconGap, contactY);
                    currentX += itemWidth + itemGap;
                });
                

                if (fixedLogo.complete && fixedLogo.naturalWidth !== 0) {
                    const logoH = fixedLogo.height * (logoW / fixedLogo.width);
                    const logoY = footerStartY - (logoH - footerHeight) / 2;
                    ctx.drawImage(fixedLogo, padding, logoY, logoW, logoH);
                }
            }

            async function handleDownload() {
                if (isProcessing || uploadedImages.length === 0) return;
                isProcessing = true;
                
                const originalText = downloadButton.innerHTML;
                downloadButton.innerHTML = '<div class="loader"></div><span>Processando...</span>';
                downloadButton.disabled = true;

                try {
                    if (uploadedImages.length === 1) {
                        const canvas = await createAdCanvas(uploadedImages[0]);
                        const link = document.createElement('a');
                        link.download = 'anuncio-veiculo.png';
                        link.href = canvas.toDataURL('image/png');
                        link.click();
                    } else {
                        const zip = new JSZip();
                        for (let i = 0; i < uploadedImages.length; i++) {
                            const canvas = await createAdCanvas(uploadedImages[i]);
                            const blob = await new Promise(resolve => canvas.toBlob(resolve, 'image/png'));
                            zip.file(`anuncio-${i + 1}.png`, blob);
                        }
                        const zipBlob = await zip.generateAsync({ type: 'blob' });
                        const link = document.createElement('a');
                        link.download = 'anuncios-veiculos.zip';
                        link.href = URL.createObjectURL(zipBlob);
                        link.click();
                        URL.revokeObjectURL(link.href);
                    }
                } catch (error) {
                    console.error("Erro ao gerar arquivo:", error);
                    alert("Ocorreu um erro ao gerar o arquivo. Tente novamente.");
                } finally {
                    isProcessing = false;
                    downloadButton.innerHTML = originalText;
                    downloadButton.disabled = false;
                }
            }
        });
    </script>
</body>
</html>

